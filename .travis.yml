os: linux
dist: trusty
sudo: required
language: python

env:
  - REPOSITORY=x11vnc/smartgit-desktop BRANCH=master
  - REPOSITORY=compdatasci/atom-desktop BRANCH=master
  - REPOSITORY=compdatasci/octave-desktop BRANCH=master
  - REPOSITORY=compdatasci/spyder-desktop BRANCH=master
  - REPOSITORY=compdatasci/rstudio-desktop BRANCH=master
  - REPOSITORY=compdatasci/ams595-desktop BRANCH=master
  - REPOSITORY=compdatasci/ams562-desktop BRANCH=master
  - REPOSITORY=fastsolve/docker-desktop BRANCH=master
  - REPOSITORY=numgeom/docker-desktop BRANCH=master
  - REPOSITORY=unifem/docker-desktop BRANCH=master

before_script:
  - git config --global user.email "xmjiao@gmail.com"
  - git config --global user.name "Xiangmin Jiao"

script:
# Update README by inserting new section for full-screen mode
  - "git clone -b $BRANCH https://$GIT_USER:$GIT_TOKEN@github.com/$REPOSITORY childrepo 2> /dev/null &&
    cd childrepo &&
    (grep -q '## Entering Full-Screen Mode' README.md || git checkout HEAD~ README.md) &&
    perl -0777 -e 's/## Entering Full-Screen Mode.+(\n##)/%%FULL_SCREEN_SECTION%%$1/igs' -p README.md | sed -e '/%%FULL_SCREEN_SECTION%%/ {' -e 'r ../doc/fullscreen.md' -e 'd' -e '}' > README.new && (diff README.new README.md || cp README.new README.md) &&
    ([[ -z $(git diff -- README.md) ]] ||
     (git commit -m 'Updated README for full-screen mode' README.md &&
      git push))"
